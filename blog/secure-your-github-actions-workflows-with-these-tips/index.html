<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.1">
<title data-rh="true">Secure Your GitHub Actions Workflows with These Tips | Sebastian Scherer</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://scherersebastian.github.io/home/blog/secure-your-github-actions-workflows-with-these-tips"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Secure Your GitHub Actions Workflows with These Tips | Sebastian Scherer"><meta data-rh="true" name="description" content="**Disclaimer** - This article is compiled from GitHub articles, linked below in the references. The purpose of this article is to serve as a summary since I found the content of the GitHub articles to be well-structured. My personal thoughts are integrated at relevant points."><meta data-rh="true" property="og:description" content="**Disclaimer** - This article is compiled from GitHub articles, linked below in the references. The purpose of this article is to serve as a summary since I found the content of the GitHub articles to be well-structured. My personal thoughts are integrated at relevant points."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-02-08T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://scherersebastian.github.io/home/"><meta data-rh="true" property="article:tag" content="Security,GitHub Actions,CI/CD"><link data-rh="true" rel="icon" href="/home/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://scherersebastian.github.io/home/blog/secure-your-github-actions-workflows-with-these-tips"><link data-rh="true" rel="alternate" href="https://scherersebastian.github.io/home/blog/secure-your-github-actions-workflows-with-these-tips" hreflang="en"><link data-rh="true" rel="alternate" href="https://scherersebastian.github.io/home/blog/secure-your-github-actions-workflows-with-these-tips" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/home/blog/rss.xml" title="Sebastian Scherer RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/home/blog/atom.xml" title="Sebastian Scherer Atom Feed"><link rel="stylesheet" href="/home/assets/css/styles.3692e5c3.css">
<link rel="preload" href="/home/assets/js/runtime~main.3727cd49.js" as="script">
<link rel="preload" href="/home/assets/js/main.4c3e6706.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/home/"><div class="navbar__logo"><img src="/home/img/logo.svg" alt="Sebastian Scherer Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/home/img/logo.svg" alt="Sebastian Scherer Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Sebastian Scherer</b></a><a class="navbar__item navbar__link" href="/home/docs/lets-hack">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/home/blog">Blog</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Apps</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/home/IssuePulse">Issue Pulse</a></li><li><a class="dropdown__link" href="/home/GitSecOps">GitSecOps</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a href="https://github.com/scherersebastian" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="navbar__search searchBarContainer_NW3z"><input placeholder="Search" aria-label="Search" class="navbar__search-input"><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div><div class="searchHintContainer_Pkmr"><kbd class="searchHint_iIMx">ctrl</kbd><kbd class="searchHint_iIMx">K</kbd></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">All posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/beyond-being-right-cultivating-a-collaborative-engineering-mindset-with-insights-from-jeff-bezos">Beyond Being Right: Cultivating a Collaborative Engineering Mindset with Insights from Jeff Bezos</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/self-check-security-encouraging-developers-with-timeless-principles">Self-Check Security: Encouraging Developers with Timeless Principles</a></li><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/home/blog/secure-your-github-actions-workflows-with-these-tips">Secure Your GitHub Actions Workflows with These Tips</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/do-users-write-more-insecure-code-with-ai-assistants">Do Users Write More Insecure Code with AI Assistants?</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/issueinjector-centralizing-all-security-findings-in-github-without-paying-for-advanced-security">IssueInjector: Centralizing All Security Findings in GitHub Without Paying for Advanced Security</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/full-disclosure-ensuring-everyone-has-the-information-they-need">Full Disclosure: Ensuring Everyone Has the Information They Need</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/how-to-suck-at-information-security">How to Suck at Information Security</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/streamlining-security-integrating-findings-as-development-issues">Streamlining Security: Integrating Findings as Development Issues</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/car-privacy-mozillas-observations">Car Privacy: Mozilla&#x27;s Observations</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/understanding-adversarial-attacks-on-llms">Understanding Adversarial Attacks on LLMs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/the-interactive-advantage-why-github-copilot-chat-is-a-game-changer">The Interactive Advantage: Why GitHub Copilot Chat is a Game-Changer</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/mastering-the-art-of-prompt-engineering">Mastering the Art of Prompt Engineering</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/us-encryption-protocols-lagging-a-global-concern">U.S. Encryption Protocols Lagging: A Global Concern</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/home/blog/low-code-vs-no-code-simplifying-software-development">Low Code vs. No Code: Simplifying Software Development</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Secure Your GitHub Actions Workflows with These Tips</h1><div class="container_mt6G margin-vert--md"><time datetime="2024-02-08T00:00:00.000Z" itemprop="datePublished">February 8, 2024</time> · <!-- -->16 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://scherersebastian.github.io/home/" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/59142915?v=4" alt="Sebastian Scherer"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://scherersebastian.github.io/home/" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Sebastian Scherer</span></a></div><small class="avatar__subtitle" itemprop="description">Security Engineer</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p><em><strong>Disclaimer</strong> - This article is compiled from GitHub articles, linked below in the references. The purpose of this article is to serve as a summary since I found the content of the GitHub articles to be well-structured. My personal thoughts are integrated at relevant points.</em></p><p>Continuous Integration and Continuous Deployment (CI/CD) software supply chains are a lucrative target for threat actors. GitHub Actions is one of the most widely used platforms for automation, making it an important target. It&#x27;s my personal favourite compared to GitLab CI/CD and Jenkins.</p><p>In the context of workflows, the <em>primary</em> threats include: Command Injections, Pwn Requests, Secret Leaks, and Third-Party Actions.</p><p>Due to the dangers inherent to <em>automatic processing of PRs</em>, an important security guarantee that GitHub makes is that workflows triggered on <code>pull_request</code> from forks (untrusted sources) are run with minimal privileges: no access to secrets and the repository token is read-only. Thus, if a workflow contains potential injection vulnerabilities, but is triggered only on <code>pull_request</code>, then the impact is minimal, because only pull requests from users able to create branches in the same repository are able to trigger the workflow with higher privileges.</p><p><em>Nevertheless, it is better to keep workflows injection free, even if they run with minimal privileges.</em></p><p>In the following sections, the primary threats will be listed along with corresponding tips for mitigation.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="command-injections">Command Injections<a href="#command-injections" class="hash-link" aria-label="Direct link to Command Injections" title="Direct link to Command Injections">​</a></h2><p>A workflow is a program that starts automatically when a specific repository event occurs. As with any program potentially started by an external user, user-controlled inputs should be treated as untrusted. In the context of workflows, this means values such as <code>github.event.issue.title</code> or <code>github.event.issue.body</code>. In particular, GitHub Actions expression evaluation is a powerful language-independent feature which may lead to script injections when used in such blocks as <code>run</code>.</p><p>This is a simple example of a workflow that is vulnerable to command injection:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> echo &quot;$</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.event.issue.title </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To exploit this, an attacker would create an issue with a title like <code>$(touch pwned.txt)</code>.</p><p>Due to the way that the <code>${{}}</code> syntax gets expanded, this causes the workflow to execute the following command <code>echo &quot;$(touch pwned.txt)&quot;</code>.</p><p>Since expression evaluation is language independent, the injection type is not Bash shell-specific. For example, when <code>${{}}</code> is used in a JS script, a syntactically valid construct can be used for injection there, too.</p><p>An attacker could use an injection vulnerability like this to achieve something far more malicious than just modifying a local file. For example, they could upload secrets to a website that they control, or commit new code to your repository to add a backdoor vulnerability or supply chain attack.</p><p><em>When used in the <code>run</code> or <code>script</code> section, the <code>${{ }}</code> syntax is almost always very dangerous.</em></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tip-1-dont-use---syntax-in-the-run-section-to-prevent-unexpected-substitution-issues">Tip 1: Don’t Use ${{ }} Syntax in the Run Section to Prevent Unexpected Substitution Issues<a href="#tip-1-dont-use---syntax-in-the-run-section-to-prevent-unexpected-substitution-issues" class="hash-link" aria-label="Direct link to Tip 1: Don’t Use ${{ }} Syntax in the Run Section to Prevent Unexpected Substitution Issues" title="Direct link to Tip 1: Don’t Use ${{ }} Syntax in the Run Section to Prevent Unexpected Substitution Issues">​</a></h3><p>The recommendation is to use <em>intermediate environment variables</em> for the potentially untrusted input and then use language-specific capabilities to retrieve the value of the variable:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> print title</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">TITLE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.event.issue.title </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> echo &quot;$TITLE&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>or</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> print title</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">TITLE</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.event.issue.title </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/github</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">script@v6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">script</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> console.log(process.env.TITLE)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using the <code>${{ }}</code> syntax in the <code>env</code> section is safer because the user-controlled string is stored in a variable instead. The syntax <code>&quot;$TITLE&quot;</code> in the updated <code>run</code> section is standard Bash syntax, which is widely known and therefore less likely to behave in a way that the author of the workflow didn’t expect. Similarly, the syntax <code>process.env.TITLE</code> is standard JavaScript syntax, so the code will behave as expected for a JavaScript program.</p><p><em>Please note that this solution doesn’t prevent other types of vulnerabilities: the <code>TITLE</code> environment still contains untrusted input and still needs to be handled with care.</em></p><p>We should carefully handle potentially untrusted input and make sure it doesn’t flow into API calls where the data could be interpreted as code.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tip-2-enable-code-scanning-for-workflows">Tip 2: Enable Code Scanning for Workflows<a href="#tip-2-enable-code-scanning-for-workflows" class="hash-link" aria-label="Direct link to Tip 2: Enable Code Scanning for Workflows" title="Direct link to Tip 2: Enable Code Scanning for Workflows">​</a></h3><p><strong>I recommend carefully reviewing your workflows, focusing on the usage of untrusted input.</strong></p><p>Additionally, to prevent accidentally introducing similar vulnerabilities in new code, I recommend to utilize code scanning for the repository.</p><p>This allows for the automation of workflow reviews. Custom queries can be written to make the scans more precise.</p><p>When using CodeQL for scanning, the following considerations must be kept in mind. <em>The CodeQL workflow scanning queries are (currently) only included in the query suite for JavaScript, so they’re only enabled by default if your project is written in JavaScript.</em> If the main programming language of your project is something else, such as Python or Java, then you need to manually modify the CodeQL workflow to add JavaScript as an additional language. The scanning will work even if your repository doesn’t contain any JavaScript; and if you are interested only in workflows, but not other JavaScript files, you can exclude some paths in the CodeQL configuration:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> .github</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">paths-ignore</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> .github/workflows/test.yaml</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Other scanning tools can also be used. For example, KICS provides pre-configured queries that can be extended. A simple script that, for instance, looks for <code>${{}}</code>, <code>pull_request_target</code>, and <code>workflow_run</code> can be quite effective. This way, a dedicated security team can review many repositories, and development teams don&#x27;t need to delve into the details, allowing them to focus on their development work.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pwn-requests">Pwn Requests<a href="#pwn-requests" class="hash-link" aria-label="Direct link to Pwn Requests" title="Direct link to Pwn Requests">​</a></h2><p>Any automated processing of PRs from an external fork is potentially dangerous and such PRs should be treated like untrusted input. It is common CI/CD practice to ensure that when a new PR is submitted that it does not break the build for your project, that no functionality regressions are introduced, and that tests are passing. But when operating on untrusted PRs, such automated behavior can leave your repository exposed to abuse if you’re not careful.</p><p>Since, by definition, a PR supplies code to any build or test logic in place for your project, attackers can achieve arbitrary code execution in a workflow runner operating on a malicious PR in a variety of ways.</p><p>They may submit malicious changes to the existing build scripts like <code>make</code> or <code>powershell</code> files or redefine the build script in the <code>package.json</code> file. They can simply write their payload as a new test that will be run with others. Any modern build orchestration is complex enough to have multiple code injection points.</p><p>Due to the dangers inherent to automatic processing of PRs, GitHub’s standard pull_request workflow trigger by default prevents write permissions and secrets access to the target repository.</p><p>However, in some scenarios such access is needed to properly process the PR. To this end the <code>pull_request_target</code> and <code>workflow_run</code> workflow triggers were introduced. They enable scenarios that require building the untrusted code, access to repository secrets and also need write permissions to update the PR with e.g. code coverage results or other test results.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tip-3-do-not-use-pull_request_target">Tip 3: Do Not Use <code>pull_request_target</code><a href="#tip-3-do-not-use-pull_request_target" class="hash-link" aria-label="Direct link to tip-3-do-not-use-pull_request_target" title="Direct link to tip-3-do-not-use-pull_request_target">​</a></h3><p>My personal advice is to never use these workflow triggers because they unnecessarily increase the attack surface. They automatically commit you to closely monitoring every PR.</p><p>Statement from <a href="https://securitylab.github.com/research/github-actions-preventing-pwn-requests/" target="_blank" rel="noopener noreferrer">GitHub Security Lab</a>:</p><p><em>&quot;Generally speaking, when the PR contents are treated as passive data, i.e. not in a position of influence over the build/testing process, it is safe. But the repository owners must be extra careful not to trigger any script that may operate on PR controlled contents like in the case of <code>npm install</code>.&quot;</em></p><p>Avoid using <code>pull_request_target</code> if the workflow doesn’t need write repository permissions and doesn’t use any repository secrets. They can simply use the <code>pull_request</code> trigger instead.</p><p>You may ask yourself: if the <code>pull_request_target</code> workflow only checks out and builds the PR, i.e. runs untrusted code but doesn’t reference any secrets, is it still vulnerable?</p><p>Yes it is, because a workflow triggered on <code>pull_request_target</code> still has the read/write repository token in memory that is potentially available to any running program. If the workflow uses <code>actions/checkout</code> and does not pass the optional parameter <code>persist-credentials</code> as <code>false</code>, it makes it even worse. The default for the parameter is <code>true</code>. It means that in any subsequent steps any running code can simply read the stored repository token from the disk.</p><p>Just stick to the <code>pull_request</code> trigger.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tip-4-add-a-condition-to-the-pull_request_target">Tip 4: Add a Condition to the <code>pull_request_target</code><a href="#tip-4-add-a-condition-to-the-pull_request_target" class="hash-link" aria-label="Direct link to tip-4-add-a-condition-to-the-pull_request_target" title="Direct link to tip-4-add-a-condition-to-the-pull_request_target">​</a></h3><p>Add a condition to the <code>pull_request_target</code> to run only if a certain label is assigned the PR, like <code>safe to test</code> that indicates the PR has been vetted by someone with write privileges to the target repository. Note that this kind of label based verification is still prone to a race condition in which the attacker may push new changes after the workflow was approved (labeled), but has not started yet. As such this approach should only be used as a temporary solution, until a proper fix from the options above is applied. Since external users do not have the permission to assign labels, this effectively requires repository owners to manually review changes first and is also prone to human error.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tip-5-rebase-prs-after-fixing-a-vulnerable-workflow">Tip 5: Rebase PRs After Fixing a Vulnerable Workflow<a href="#tip-5-rebase-prs-after-fixing-a-vulnerable-workflow" class="hash-link" aria-label="Direct link to Tip 5: Rebase PRs After Fixing a Vulnerable Workflow" title="Direct link to Tip 5: Rebase PRs After Fixing a Vulnerable Workflow">​</a></h3><p>All PRs that were opened before a fix was made to the vulnerable workflow will use the version of the workflow as it existed at the time the PR was opened. That means that if there is a pending PR, any updates to the PR may still abuse the vulnerable workflow. It is advisable to either close or rebase such PRs if untrusted commits may be added to them after a vulnerable workflow is fixed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="secret-leaks">Secret Leaks<a href="#secret-leaks" class="hash-link" aria-label="Direct link to Secret Leaks" title="Direct link to Secret Leaks">​</a></h2><p>Workflows triggered via the <code>pull_request</code> event from forks have read-only permissions and no access to secrets. With it, the triggered workflow runs in the context of the (submitter&#x27;s) fork repo. Therefore the provided <code>GITHUB_TOKEN</code> will not have write access and the secrets are not accessible either.
However, these permissions differ between the various event triggers such as <code>issue_comment</code>, <code>issues</code> and <code>push</code>. An attacker could try to steal the repository secrets or even the repository write access token. If a secret or token is set to an environment variable like:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">env</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">GITHUB_TOKEN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.token </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">PUBLISH_KEY</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.PUBLISH_KEY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It can be directly accessed through the environment as demonstrated with e.g.: <code>printenv</code>.</p><p>If the secret is used directly in a expression like:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> publisher $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.PUBLISH_KEY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>or</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> fakeaction/publish@v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">key</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.PUBLISH_KEY </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, in the first case, the generated shell script is stored on disk and can be accessed there. In the second case it depends on the way the program is using the argument.</p><p><code>Actions/checkout</code> action by default stores the repository token in a <code>.git/config</code> file unless the <code>persist-credentials: false</code> argument is set. Even if this is not the case the repository token and secrets are still in memory. Although GitHub Actions scrub secrets from memory that are not referenced in the workflow or in an included Action, the repository token, whether it is referenced or not, and any referenced secrets can be harvested by a determined attacker.</p><p>The next question for the attacker is how to exfiltrate such secrets from the runner. GitHub Actions automatically redact secrets printed to the log in order to prevent accidental secret disclosure, but it is not a true security boundary since it is impossible to protect from intentional logging, so exfiltration of obfuscated secrets is still possible. For example: <code>echo ${SOME_SECRET:0:4}; echo ${SOME_SECRET:4:200};</code>. Also, since the attacker may run arbitrary commands it is possible to simply make a HTTP request to an external attacker-controlled server with the secret.</p><p>Getting a repository access token is a bit harder. An Action runner gets a generated token with permissions that are limited to the repository that contains the workflow and which expires after the workflow completes. Once expired, the token is no longer useful to an attacker. One way to work around this limitation, is to automate the attack and perform it in fractions of a second by calling an attacker-controlled server with the token. The attacker server can use the GitHub API to modify repository content, including releases.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tip-6-keep-workflows-injection-free">Tip 6: Keep Workflows Injection free<a href="#tip-6-keep-workflows-injection-free" class="hash-link" aria-label="Direct link to Tip 6: Keep Workflows Injection free" title="Direct link to Tip 6: Keep Workflows Injection free">​</a></h3><p>Keep workflows injection free, even if they run with minimal privileges.</p><p>The best practice to avoid code and command injection vulnerabilities in GitHub workflows is to set the untrusted input value of the expression to an intermediate environment variable, as previously described.</p><p>Refer to the section above on Command Injections for more information.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tip-7-use-the-principle-of-least-privilege">Tip 7: Use the Principle of Least Privilege<a href="#tip-7-use-the-principle-of-least-privilege" class="hash-link" aria-label="Direct link to Tip 7: Use the Principle of Least Privilege" title="Direct link to Tip 7: Use the Principle of Least Privilege">​</a></h3><p>GitHub introduced a more fine grained permission model for workflow tokens (<code>GITHUB_TOKEN</code>) and, today, the default permissions for new repositories and organizations are set to read-only.</p><p>If you want to check if you are using a broad default permission for your workflow tokens, you can go to the <em>repository (or organization) settings-&gt;actions and check the “Workflow permissions” section</em>.</p><p>Every GitHub workflow receives a temporary repository access token (<code>GITHUB_TOKEN</code>).</p><p>To help you more smoothly navigate the transition to a least-privilege workflow token model, we have published a set of GitHub Actions that allow you to monitor and enumerate the set of privileges that are required by a given GitHub workflow.</p><p>The <a href="https://github.com/GitHubSecurityLab/actions-permissions/tree/main/monitor" target="_blank" rel="noopener noreferrer">Monitor action</a> installs a local proxy (no information is sent to any third parties) into your workflow runner, collects information about any GitHub API interactions initiated by the workflow, and then displays the recommended minimal permissions as part of a workflow run summary:</p><p><img loading="lazy" alt="Monitor action" src="/home/assets/images/actions-tool-1-b690c313dbaee898a27cd19a326cc4e4.webp" width="1024" height="871" class="img_ev3q"></p><p>You can grant additional permissions to specific workflows on a case-by-case basis if needed:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">job_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">permissions</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">issues</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> write</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If access to any scope is specified, all unspecified scopes like <code>contents</code>, <code>pull-requests</code> or <code>actions</code> are set to <code>none</code>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="third-party-actions">Third-Party Actions<a href="#third-party-actions" class="hash-link" aria-label="Direct link to Third-Party Actions" title="Direct link to Third-Party Actions">​</a></h2><p>Actions allow you to quickly create automatic workflows from convenient building blocks: actions published by other developers. <em>GitHub Marketplace</em> has thousands of free actions available for consumption.</p><p>By referencing an action with the uses: directive, you’re running third-party code and giving it access to:</p><ul><li><p>Computing time</p></li><li><p>Secrets used in the same workflow job</p></li><li><p>Your repository token</p></li></ul><p>Read access to secrets, such as deployment keys, could also be used by malicious actors for lateral movement (in other words, for compromising other resources). Although only the secrets referenced or used in the workflow job are potentially accessible to the action, the repository token is different. Even if the GITHUB_TOKEN is not explicitly used in a workflow, it’s still available for all referenced actions. Attackers that control the YAML definition of the action may add, for example, a new input field and set the default value to the repository token:</p><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">inputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">random_name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> github.token </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It’s fair to assume that anyone who controls the YAML action definition has access to the temporary repository token in a context of the running workflow that consumes the action. This means you should carefully review the permissions you supply to the workflows you’re running.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tip-8-following-the-principle-of-least-privilege">Tip 8: Following the Principle of Least Privilege<a href="#tip-8-following-the-principle-of-least-privilege" class="hash-link" aria-label="Direct link to Tip 8: Following the Principle of Least Privilege" title="Direct link to Tip 8: Following the Principle of Least Privilege">​</a></h3><p>The principle of least privilege states that software should run with the minimal set of permissions needed to accomplish the task. This applies both to the privileges of secrets available for your workflows and the automatically supplied temporary repository token (<code>GITHUB_TOKEN</code>), which is based on the workflow trigger type.</p><p>Refer to the previous subsection above on least privilege for more information.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tip-9-properly-referencing-actions">Tip 9: Properly Referencing Actions<a href="#tip-9-properly-referencing-actions" class="hash-link" aria-label="Direct link to Tip 9: Properly Referencing Actions" title="Direct link to Tip 9: Properly Referencing Actions">​</a></h3><p>Adding a new action to a workflow requires careful consideration of security impact.</p><p>Some actions have a <em>“Verified creator”</em> badge that can help you decide the level of trust you place in the action creator. It is not yet common and therefore unfortunately not very helpful.</p><p>The best approach is to audit the code behind the action, just like you would for open source libraries, to assess whether it’s reasonably secure and doesn’t do anything suspicious like sending secrets to third-party hosts. Thankfully, many actions are designed for a single purpose and are relatively easy to read.</p><p>Once you’ve verified the action’s code, there are multiple ways of referencing it in your workflow:</p><ul><li><p><strong>By full hash changeset reference</strong>: <code>uses: owner/action-name@26968a09c0ea4f3e233fdddbafd1166051a095f6</code>. Currently, this is the safest way to reference a specific snapshot of an action.</p></li><li><p><strong>Fork the action</strong>: Depending on your needs, you could fork the action and reference the fork in your workflows. You may need to set up vetted updates from the original repository in order to get potential security fixes, though. <em>Makes particular sense for actions that are commonly used across the enterprise.</em></p></li></ul><p>As you can see, all options are a tradeoff between guaranteed supply chain integrity and auto-patching of vulnerabilities in dependencies / actions. In all cases except the last, it’s possible to configure Dependabot to create a pull request when the action is updated. In order to protect repository secrets, such pull requests are treated as if they come from external forks. You can set up actions to automatically accept and merge these pull requests from Dependabot. However, accepting changes without reviewing them isn’t the most secure approach. Every time the referenced action is updated, I recommend that you verify what has changed in the action source code - <em>that&#x27;s a real challenge to keep up with</em>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h2><p>GitHub Actions are a great way to rapidly build a functional CI/CD pipeline for your GitHub projects. From an attacker’s perspective, they are part of a much broader CI/CD attack surface that also includes any third-party artifact integrations and API interactions. Beyond the usual code review for untrusted input handling, CI/CD supply chain integrity requires careful vetting of your dependencies and any changes that occur in those dependencies. By applying the concepts of least privilege, change attestation, and tracking as well as ensuring that third parties don’t have mutable control over your CI/CD supply chain, you can actively start to take charge of your CI/CD supply chain security.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="references">References<a href="#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References">​</a></h2><ul><li><p><a href="https://github.blog/2023-08-09-four-tips-to-keep-your-github-actions-workflows-secure/" target="_blank" rel="noopener noreferrer">Four tips to keep your GitHub Actions workflows secure</a></p></li><li><p><a href="https://securitylab.github.com/research/github-actions-preventing-pwn-requests/" target="_blank" rel="noopener noreferrer">Keeping your GitHub Actions and workflows secure Part 1: Preventing pwn requests</a></p></li><li><p><a href="https://securitylab.github.com/research/github-actions-untrusted-input/" target="_blank" rel="noopener noreferrer">Keeping your GitHub Actions and workflows secure Part 2: Untrusted input</a></p></li><li><p><a href="https://securitylab.github.com/research/github-actions-building-blocks/" target="_blank" rel="noopener noreferrer">Keeping your GitHub Actions and workflows secure Part 3: How to trust your building blocks</a></p></li><li><p><a href="https://blog.gitguardian.com/github-actions-security-cheat-sheet/" target="_blank" rel="noopener noreferrer">GitHub Actions Security Best Practices - cheat sheet included</a></p></li></ul></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/home/blog/tags/security">Security</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/home/blog/tags/git-hub-actions">GitHub Actions</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/home/blog/tags/ci-cd">CI/CD</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/scherersebastian/home/blob/main/blog/2024-02-08-secure-your-github-actions-workflows-with-these-tips/index.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/home/blog/self-check-security-encouraging-developers-with-timeless-principles"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Self-Check Security: Encouraging Developers with Timeless Principles</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/home/blog/do-users-write-more-insecure-code-with-ai-assistants"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Do Users Write More Insecure Code with AI Assistants?</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#command-injections" class="table-of-contents__link toc-highlight">Command Injections</a><ul><li><a href="#tip-1-dont-use---syntax-in-the-run-section-to-prevent-unexpected-substitution-issues" class="table-of-contents__link toc-highlight">Tip 1: Don’t Use ${{ }} Syntax in the Run Section to Prevent Unexpected Substitution Issues</a></li><li><a href="#tip-2-enable-code-scanning-for-workflows" class="table-of-contents__link toc-highlight">Tip 2: Enable Code Scanning for Workflows</a></li></ul></li><li><a href="#pwn-requests" class="table-of-contents__link toc-highlight">Pwn Requests</a><ul><li><a href="#tip-3-do-not-use-pull_request_target" class="table-of-contents__link toc-highlight">Tip 3: Do Not Use <code>pull_request_target</code></a></li><li><a href="#tip-4-add-a-condition-to-the-pull_request_target" class="table-of-contents__link toc-highlight">Tip 4: Add a Condition to the <code>pull_request_target</code></a></li><li><a href="#tip-5-rebase-prs-after-fixing-a-vulnerable-workflow" class="table-of-contents__link toc-highlight">Tip 5: Rebase PRs After Fixing a Vulnerable Workflow</a></li></ul></li><li><a href="#secret-leaks" class="table-of-contents__link toc-highlight">Secret Leaks</a><ul><li><a href="#tip-6-keep-workflows-injection-free" class="table-of-contents__link toc-highlight">Tip 6: Keep Workflows Injection free</a></li><li><a href="#tip-7-use-the-principle-of-least-privilege" class="table-of-contents__link toc-highlight">Tip 7: Use the Principle of Least Privilege</a></li></ul></li><li><a href="#third-party-actions" class="table-of-contents__link toc-highlight">Third-Party Actions</a><ul><li><a href="#tip-8-following-the-principle-of-least-privilege" class="table-of-contents__link toc-highlight">Tip 8: Following the Principle of Least Privilege</a></li><li><a href="#tip-9-properly-referencing-actions" class="table-of-contents__link toc-highlight">Tip 9: Properly Referencing Actions</a></li></ul></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li><li><a href="#references" class="table-of-contents__link toc-highlight">References</a></li></ul></div></div></div></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a class="footer__link-item" href="/home/docs/lets-hack">Docs</a><span class="footer__link-separator">·</span><a class="footer__link-item" href="/home/blog">Blog</a><span class="footer__link-separator">·</span><a href="https://github.com/scherersebastian" target="_blank" rel="noopener noreferrer" class="footer__link-item">Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">·</span><a href="https://de.linkedin.com/in/sebastian-scherer-9039a3201" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Sebastian Scherer</div></div></div></footer></div>
<script src="/home/assets/js/runtime~main.3727cd49.js"></script>
<script src="/home/assets/js/main.4c3e6706.js"></script>
</body>
</html>